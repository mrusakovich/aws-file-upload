<script>
  const btn = document.getElementById('uploadBtn');
  const input = document.getElementById('bucket_files');
  const flash = document.getElementById('flash');

  async function upload(file) {
    const data = new FormData();
    data.append('authenticity_token', "<%= form_authenticity_token %>")
    data.append('file', file);

    return await fetch("<%= upload_bucket_path %>", {
      method: 'PUT',
      body: data
    })
  }

  btn.addEventListener('click', async () => {
    const files = Array.from(input.files);

    for (const [index, file] of files.entries()) {
      flash.innerHTML = `processing ${index + 1} out of ${input.files.length}`
      await upload(file);
    }

    window.location = "<%= uploads_path %>"
  });
</script>
